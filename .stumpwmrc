;; -*- mode: common-lisp; -*-
(require 'swank)
(in-package :stumpwm)


;; Engage!
(swank:create-server)

;; Style customizations
(set-focus-color               "#336699")
(set-unfocus-color             "#336699")
(setf *input-window-gravity*   :center)
(setf *maxsize-border-width*   3)
(setf *message-window-gravity* :center)
(setf *normal-border-width*    3)
(setf *transient-border-width* 3)
(setf *window-border-style*    :thick)


;; mode-line
(setf *mode-line-timeout* 1)
(setf *screen-mode-line-format*
      (list '(:eval (run-shell-command "date" t))))


(defun take (seq n)
  (subseq seq 0 n))

(defun partition (seq n)
  (loop for cell on seq by
       #'(lambda (list)
           (nthcdr n list))
     collecting (subseq cell 0 n)))

(dotimes (i 10)
  (progn
    (gnew (format nil "~d" i))
    (define-key *top-map*
        (kbd (format nil "M-~d" i))
      (format nil "gselect ~s" i))))

(defcommand set-volume (n) ((:string "Amount:"))
  "Changes the volume"
  (let ((command-str (format nil "amixer -c 0 --quiet set Master ~s" n)))
    (run-shell-command command-str)))

(defcommand ncmpcpp (what) ((:string "Command:"))
  "Sends a command to ncmpcpp"
  (run-shell-command (format nil "ncmpcpp ~s" what)))
(defmacro spawn-with (key-combo command)
  `(define-key *top-map* (kbd ,key-combo) ,command))

(defun spawn-with* (pair)
  `(spawn-with ,(first pair) ,(second pair)))

(defmacro spawn-many (&rest pairs)
  (let ((pairs (partition pairs 2)))
    `(progn
       ,@(mapcar #'spawn-with* pairs))))

(spawn-many
 "M-E" "exec emacsclient -c"
 "M-F" "exec chromium"
 "S-M-RET" "exec termite"
 "M-I" "exec termite -e 'ssh xeno@zerolength.com -t tmux attach-session -d -t weechat'"
 "M-j" "fnext"
 "M-J" "move-window right"
 "M-H" "move-window left"
 "M-M" "exec termite -e 'ncmpcpp'"
 "s-s" "hsplit"
 "s-S" "vsplit"
 "s-r" "remove"
 "s-R" "resize"
 "M-C" "delete"
 "M-Q" "quit"
 "M-S" "exec skype"
 "M-Y" "exec pidgin"
 "M-V" "exec vlc"
 "M-K" "exec keepassx"
 "s-m" "exec termite -e 'mutt'"
 "M-F5" "ncmpcpp pause"
 "M-F6" "exec amixer -c 0 --quiet set Master mute"
 "M-F7" "exec amixer set Master unmute"
 "M-F8" "ncmpcpp play"
 "M-F11" "set-volume -1"
 "C-p" "exec dmenu_run")
